<!DOCTYPE html>
<html lang="en">
<head>
	<title>Outdoor 3D Scene</title>
	<style>
		body {
			margin: 0;
			background-color: rgb(237, 215, 247);
		}
		canvas {
			width: 100%;
			height: 100%;
		}
	</style>
</head>
<body>
	<h2 class="name">Talon Baker</h2>
	<div id="container"></div>

	<!-- Loading JS -->
	<script src="js/three.js"></script>
	<script src="js/OrbitControls.js"></script>
	<script src="js/KeyboardState.js"></script>
	<script src="js/OBJLoader.js"></script>

	<!-- <script src="js/engine.js"></script> -->
	<script src="js/create-skybox.js"></script>
	
	<!-- Loading Shaders -->
	<script src="shaders/vs-enviromentMap.js"></script>
	<script src="shaders/fs-enviromentMap.js"></script>

	<script src="shaders/vs-skybox.js"></script>
	<script src="shaders/fs-skybox.js"></script>

	<script src="shaders/vs-heightTextureMap.js"></script>
	<script src="shaders/fs-heightTextureMap.js"></script>

	<script src="shaders/vs-waterHeightMap.js"></script>
	<script src="shaders/fs-waterHeightMap.js"></script>

	<!-- THREEjs -->
	<script>

		var container, renderer, scene, camera, constols, carrot, waterPlane, plane, skybox;

		var texture1 = new THREE.TextureLoader().load( 'assets/map.png' );
		var texture2 = new THREE.TextureLoader().load( 'assets/grass.png' );
		var texture3 = new THREE.TextureLoader().load( 'assets/snow.jpg' );
		var texture4 = new THREE.TextureLoader().load( 'assets/hill.jpg' );

		init();
		animate();

		function init() {
			container = document.getElementById( 'container' );

			// defining the renderer
			renderer = new THREE.WebGLRenderer();
			renderer.setClearColor( 0x999999 );
			renderer.setPixelRatio( window.devicePixelRatio );
			renderer.setSize( window.innerWidth, window.innerHeight );
			container.appendChild( renderer.domElement );

			// container.appendChild( renderer.domElement );

			// defining the scene
			scene = new THREE.Scene();

			// defining the camrea
			camera = new THREE.PerspectiveCamera(50, window.innerWidth/window.innerHeight, 0.1, 1000);

			// orbit controls for mouse movement of the scene
			controls = new THREE.OrbitControls( camera );


			// creating skybox
			skybox = createSkybox( 1000, [
		        'assets/skyboxes/skybox2_px.png',
		        'assets/skyboxes/skybox2_nx.png',
		        'assets/skyboxes/skybox2_py.png',
		        'assets/skyboxes/skybox2_ny.png',
		        'assets/skyboxes/skybox2_pz.png',
		        'assets/skyboxes/skybox2_nz.png',
		    ] );



			// creating plane
			planeGeometry = new THREE.PlaneGeometry( 50, 50, 300, 300 );

			var planeUniform =  {
				displaceAmt: { type: "f", value: 1.0       },
				tPic:        { type: "t", value: texture1  },
				tGrass:      { type: "t", value: texture2  },
				tSnow:       { type: "t", value: texture3  },
				tHill:       { type: "t", value: texture4  },
			};

			var planeMaterial = new THREE.RawShaderMaterial( {
				uniforms:       planeUniform,
				vertexShader:   vs_heightTextureMap,
				fragmentShader: fs_heightTextureMap,
			} );

			var plane = new THREE.Mesh( planeGeometry, planeMaterial );
			plane.material.side = THREE.DoubleSide;
			plane.rotateX( -Math.PI/2 );
			plane.rotateZ( Math.PI );



			// creating water plane
			waterPlaneGeometry = new THREE.PlaneGeometry( 50, 50, 300, 300 );

			var waterPlaneUniorm = {
				displaceAmt: { type: "f", value: 0.0 },
				time:      { type: "f", value: 0.0 },
			}

			var waterPlaneMaterial = new THREE.RawShaderMaterial( {
				uniforms:       waterPlaneUniorm,
				vertexShader:   vs_waterHeightMap,
				fragmentShader: fs_waterHeightMap,
			} );

			waterPlane = new THREE.Mesh( waterPlaneGeometry, waterPlaneMaterial );
			waterPlane.material.side = THREE.DoubleSide;
			waterPlane.position.y -= 0.05;
			waterPlane.rotateX( -Math.PI/2 );
			waterPlane.rotateZ( Math.PI );

			waterPlane.material.uniforms.displaceAmt.value += 0.075;

			// creating carrot
			var loader = new THREE.OBJLoader();

			var shinyMaterial = new THREE.RawShaderMaterial( {
				vertexShader:   vs_enviromentMap,
				fragmentShader: fs_enviromentMap,
			});

			loader.load( 'assets/carrot.obj', function ( carrot ) {
				carrot.traverse( function ( child ) {
					if ( child instanceof THREE.Mesh ) {
						child.material = shinyMaterial;
					}
				} );
				var s = 2.0;
				carrot.scale.set( s, s, s );
				carrot.position.y += 0.5;

				scene.add( carrot );
			} );

			// creating rabbit
			loader.load('assets/rabbit.obj',
				function ( rabbit ) {
					rabbit.traverse( function ( child ) {
						if ( child instanceof THREE.Mesh ) {
							child.material = shinyMaterial;
						}
					} );
					var s = 0.005;
					rabbit.scale.set( s, s, s );
					rabbit.rotateX( -Math.PI/2 );
					rabbit.rotateZ( Math.PI/4 );
					rabbit.position.set( 0.0, 0.0, -1.6 );

					scene.add( rabbit );
				} );

			// adding the objects to the scene
		    scene.add( skybox );
		    scene.add( plane );
		    scene.add( waterPlane );

		}// end - init()

	    function onWindowResize( event ) {
			camera.aspect = window.innerWidth / window.innerHeight;
			camera.updateProjectionMatrix();
			renderer.setSize( window.innerWidth, window.innerHeight );
	    }

	    function animate() {

	    	waterPlane.material.uniforms.time.value += 0.01;

			requestAnimationFrame( animate );
			controls.update();
			renderer.render( scene, camera );
	    }
	</script>
</body>
</html>