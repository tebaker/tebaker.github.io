<!DOCTYPE html>
<html lang="en">
<head>
  <title>three.js webgl - blender -json</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
  <style>
  body {
    background:#777;
    padding:0;
    margin:0;
    overflow:hidden;
  }

  #info {
    position: absolute;
    top: 0px;
    width: 100%;
    color: #ffffff;
  }

</style>
</head>
<body>

  <script>

      container = document.getElementById( 'container' );

      camera = new THREE.PerspectiveCamera( 50, window.innerWidth / window.innerHeight, 1, 2000 );
      var controls = new THREE.OrbitControls( camera );
      camera.position.set( 0, 0, 5 );
      controls.update();

      scene = new THREE.Scene();
      
      var cubeMap = new THREE.CubeTextureLoader()
      .setPath( './' )
      .load( [
        'assets/skybox_px.png',
        'assets/skybox_nx.png',
        'assets/skybox_py.png',
        'assets/skybox_ny.png',
        'assets/skybox_pz.png',
        'assets/skybox_nz.png',
      ] );
      
      var uniforms = { "tCube": { type: "t", value: cubeMap },
      "tFlip": { type: "f", value: -1 } };
      
      var material = new THREE.RawShaderMaterial( {
        uniforms: uniforms,
        vertexShader: sb_vs,
        fragmentShader: sb_fs
      } );

      material.depthWrite = false;
      material.side = THREE.BackSide;

      var geometry = new THREE.BoxGeometry( 2000, 2000, 2000 );

      skyMesh = new THREE.Mesh( geometry, material );

      scene.add( skyMesh );      

      var uniforms2 = {
        tCube: { type: "t", value: cubeMap },
      };

      var material2 = new THREE.RawShaderMaterial( {
        uniforms: uniforms2,
        vertexShader: em_vs,
        fragmentShader: em_fs
      } );

      var loader = new THREE.OBJLoader();

      loader.load( 'assets/carrot.obj', function ( object ) {

        object.traverse( function ( child ) {
          if ( child instanceof THREE.Mesh ) {
            child.material = material2;
          }
        } );

        var s = 2.0;
        object.scale.set( s, s, s );
        object.position.x += 1.0;
        object.position.y -= 0.5;

        carrot = object;
        scene.add( carrot );
      } );//end - load Obj

      // geometry

      var geometryPlane = new THREE.PlaneGeometry( 5, 5, 300, 300 );

      // material

      var uniforms1 =  {
        displaceAmt: { type: "f", value: 0.0 },
        tPic: { type: "t", value: texture1  },
        tGrass: { type: "t", value: texture2  },
        tSnow: { type: "t", value: texture3  },
        tHill: { type: "t", value: texture4  },
      };

      var materialGround = new THREE.RawShaderMaterial( {

        uniforms: uniforms1,
        vertexShader: vs,
        fragmentShader: fs,

      } );

      var ground = new THREE.Mesh( geometryPlane, materialGround );
      ground.material.side = THREE.DoubleSide;
      ground.rotateX(-Math.PI/3);
      scene.add( ground );

      renderer = new THREE.WebGLRenderer();
      renderer.setPixelRatio( window.devicePixelRatio );
      renderer.setSize( window.innerWidth, window.innerHeight );
      container.appendChild( renderer.domElement );

      window.addEventListener( 'resize', onWindowResize, false );
      document.addEventListener('mousemove', onDocumentMouseMove, false);

    }// end - init()

    function onWindowResize( event ) {

      renderer.setSize( window.innerWidth, window.innerHeight );

      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
    }

    function animate() {

      requestAnimationFrame( animate );
      render();
    }

    function render() {
      renderer.render( scene, camera );
    }

    function onDocumentMouseMove(event) {
      event.preventDefault();
    }


  </script>
</body>
</html>
